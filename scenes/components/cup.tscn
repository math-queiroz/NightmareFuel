[gd_scene load_steps=10 format=3 uid="uid://c3xx80ei5ycgw"]

[ext_resource type="Script" path="res://scripts/components/Cup.gd" id="1_rkeq1"]
[ext_resource type="AudioStream" uid="uid://bslbvoirnlv0x" path="res://sounds/mug.wav" id="2_pthj0"]
[ext_resource type="Texture2D" uid="uid://crb82o18qpi1o" path="res://sprites/cup_large.png" id="3_ooowr"]
[ext_resource type="PackedScene" uid="uid://iroykxv0rbm2" path="res://scenes/components/liquid_sprite.tscn" id="4_qhpb8"]
[ext_resource type="PackedScene" uid="uid://c8va1d6q5rlfe" path="res://scenes/components/spill_point.tscn" id="5_rqmf6"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_j507e"]
size = Vector2(18, 14)

[sub_resource type="OccluderPolygon2D" id="OccluderPolygon2D_0ttnj"]
polygon = PackedVector2Array(-7, -13, -7, 14, 11, 14, 11, -13)

[sub_resource type="Shader" id="Shader_nb3gh"]
resource_local_to_scene = true
code = "shader_type canvas_item;

uniform vec3 Color1 : source_color;
uniform vec3 Color2 : source_color;
uniform vec3 Color3 : source_color;
uniform vec3 Color4 : source_color;
uniform vec4 Weights;

uniform float RimHeight = 0.1;
uniform float RimBightness = 0.25;

uniform float Percentage = 0.5;

varying float y_rotation;

void vertex() {
	y_rotation = atan(MODEL_MATRIX[0][1], MODEL_MATRIX[0][0]);
}

void fragment() {
	float rotated_y = cos(-y_rotation) * (UV.y - 0.5) - sin(-y_rotation) * (UV.x - 0.5) + 0.5;
	vec3 Color = (Color1*Weights.x + Color2*Weights.y + Color3*Weights.z + Color4*Weights.w) / (Weights.x+Weights.y+Weights.z+Weights.w);
	COLOR.a -= step(rotated_y, 1.207 - Percentage * 1.207);
	COLOR.rgb = Color.rgb;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_03qn5"]
resource_local_to_scene = true
shader = SubResource("Shader_nb3gh")
shader_parameter/Color1 = Color(1, 0.933333, 0.6, 1)
shader_parameter/Color2 = Color(0.8, 0.6, 1, 1)
shader_parameter/Color3 = Color(1, 0.6, 0.607843, 1)
shader_parameter/Color4 = Color(0.6, 0.760784, 1, 1)
shader_parameter/Weights = Vector4(1, 0, 0, 0)
shader_parameter/RimHeight = 0.035
shader_parameter/RimBightness = -0.2
shader_parameter/Percentage = 0.0

[node name="Cup" type="CharacterBody2D"]
y_sort_enabled = true
position = Vector2(318, 79)
collision_layer = 8
collision_mask = 5
input_pickable = true
script = ExtResource("1_rkeq1")
hold_sound = ExtResource("2_pthj0")

[node name="CollisionShape2D" type="CollisionPolygon2D" parent="."]
polygon = PackedVector2Array(-12, 17, 18, 17, 15, -18, -9, -18, -9, -9, -17, -9, -18, 7, -10, 8)

[node name="Area2DIce" type="Area2D" parent="."]
position = Vector2(2, 0)
collision_layer = 0
collision_mask = 16

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2DIce"]
position = Vector2(0, -1)
shape = SubResource("RectangleShape2D_j507e")

[node name="ParticleCollider" type="LightOccluder2D" parent="."]
occluder = SubResource("OccluderPolygon2D_0ttnj")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture_filter = 1
position = Vector2(-1, 0)
texture = ExtResource("3_ooowr")

[node name="Sprite2DLiquid" parent="." instance=ExtResource("4_qhpb8")]
material = SubResource("ShaderMaterial_03qn5")
position = Vector2(2, 0)

[node name="SpillPoint" parent="." instance=ExtResource("5_rqmf6")]
position = Vector2(-9, -16)
use_alt_spill_point = true

[node name="AltSpillPoint" type="Node2D" parent="SpillPoint"]
position = Vector2(22, 0)
